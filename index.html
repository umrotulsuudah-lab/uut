<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kuis Interaktif Kediri Raya</title>
    <!-- Load Tailwind CSS CDN for modern styling --><script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Tone.js for audio generation --><script src="https://unpkg.com/tone@14.8.49/build/Tone.js"></script>
    <style>
        /* Menggunakan font Inter sebagai standar modern */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f3ff6;
            overflow: hidden; /* Mencegah scroll saat ada transisi */
        }
        /* Styling untuk background Simpang Lima Gumul (SLG) yang lembut */
        .slg-bg {
            /* URL gambar diubah menjadi file lokal 'Monumen-Simpang-Lima-Gumul.jpg' */
            background-image: url('Monumen-Simpang-Lima-Gumul.jpg');
            background-size: cover;
            background-position: center;
            filter: blur(8px);
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            transition: all 0.5s ease;
        }

        /* Container utama dengan efek kaca/blur */
        .main-container {
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            position: relative;
        }

        /* Styling Card Kaca */
        .glass-card {
            background-color: rgba(255, 255, 255, 0.85); /* Sedikit transparan */
            backdrop-filter: blur(10px);
            border-radius: 1.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding: 2.5rem;
            transition: all 0.5s ease;
            max-width: 500px;
            width: 100%;
        }

        /* Tombol Utama Glow */
        .btn-glow {
            background-image: linear-gradient(135deg, #FFD700 0%, #000080 100%); /* Emas ke Biru Navy */
            color: white;
            transition: all 0.3s ease;
            border: none;
        }
        .btn-glow:hover {
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.8), 0 0 30px rgba(0, 0, 128, 0.5);
            transform: translateY(-2px);
        }
        
        /* Tombol Level Oval Depan Bawah */
        .level-btn {
            background-color: #000080; /* Biru Navy */
            color: #FFD700; /* Emas */
            border-radius: 1.5rem 0.5rem 2.5rem 0.5rem; /* Oval Depan Bawah Khas */
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            font-weight: 600;
        }
        .level-btn:hover:not(.locked) {
            background-color: #000050;
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.5), 0 0 5px rgba(255, 215, 0, 0.2);
            transform: scale(1.02);
        }
        
        /* Tombol Level Terkunci */
        .level-btn.locked {
            opacity: 0.4;
            cursor: not-allowed;
            background-color: #6b7280; /* Abu-abu */
            color: #d1d5db;
            box-shadow: none;
        }
        
        /* Animasi Fade In */
        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
            opacity: 0;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Animasi Slide */
        .slide-up {
            animation: slideUp 0.6s cubic-bezier(0.165, 0.84, 0.44, 1) forwards;
            opacity: 0;
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(50px); }
            to { opacity: 1; transform: translateY(0); }
        }

    </style>
</head>
<body>

    <!-- Audio Control Button --><button id="mute-btn" class="fixed top-4 right-4 z-50 p-3 rounded-full bg-blue-900 text-yellow-300 shadow-xl hover:bg-blue-800 transition">
        <!-- Icon Speaker (Mute/Unmute handled by JS) --><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H3a1 1 0 01-1-1V9a1 1 0 011-1h2.586l7-7h1a1 1 0 011 1v12a1 1 0 01-1 1h-1l-7-7z" />
        </svg>
    </button>
    
    <!-- Background SLG --><div class="slg-bg"></div>

    <!-- Main Container to Center Content --><div class="main-container">
        
        <!-- Halaman Utama (Home Page) --><div id="home-page" class="page active">
            <div class="glass-card slide-up text-center">
                <h1 class="text-4xl font-extrabold text-blue-900 mb-2">Kuis Kediri Raya</h1>
                <p class="text-lg text-gray-600 mb-8">Uji pengetahuanmu tentang Kota dan Kabupaten Kediri!</p>

                <div id="welcome-box">
                    <form id="player-form" class="space-y-4 text-left">
                        <div>
                            <label for="player-name" class="block text-sm font-medium text-gray-700">Nama</label>
                            <input type="text" id="player-name" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-3 transition duration-150 ease-in-out">
                        </div>
                        <div>
                            <label for="player-class" class="block text-sm font-medium text-gray-700">Kelas</label>
                            <input type="text" id="player-class" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-3 transition duration-150 ease-in-out">
                        </div>
                        <div>
                            <label for="player-school" class="block text-sm font-medium text-gray-700">Asal Sekolah</label>
                            <input type="text" id="player-school" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 p-3 transition duration-150 ease-in-out">
                        </div>
                        <div id="error-message" class="text-red-600 text-sm hidden font-medium">Semua kolom wajib diisi!</div>
                        <button type="submit" class="w-full mt-6 py-4 px-6 rounded-xl btn-glow text-xl font-bold uppercase tracking-wider">
                            Mulai Kuis
                        </button>
                    </form>
                </div>
                
                <div id="player-info-display" class="hidden mt-4 text-gray-800 text-left space-y-2">
                    <h2 class="text-2xl font-semibold mb-4 text-blue-800">Selamat Datang!</h2>
                    <p><strong>Nama:</strong> <span id="display-name"></span></p>
                    <p><strong>Kelas:</strong> <span id="display-class"></span></p>
                    <p><strong>Sekolah:</strong> <span id="display-school"></span></p>
                    <button id="resume-quiz-btn" class="w-full mt-6 py-4 px-6 rounded-xl btn-glow text-xl font-bold uppercase tracking-wider">
                        Lanjutkan Kuis
                    </button>
                    <button id="change-player-btn" class="w-full mt-3 py-2 px-4 rounded-xl bg-gray-300 text-gray-800 hover:bg-gray-400 transition font-semibold">
                        Ganti Pemain
                    </button>
                </div>

            </div>
        </div>
        
        <!-- Halaman Pemilihan Level (Level Selection) --><div id="level-select-page" class="page hidden w-full max-w-4xl">
            <h1 class="text-4xl font-extrabold text-white text-center mb-10 slide-up">Level Kuis Kediri Raya</h1>
            <div id="level-grid" class="grid grid-cols-2 md:grid-cols-5 gap-4 fade-in">
                <!-- Level buttons will be generated here by JavaScript --></div>
        </div>

        <!-- Halaman Kuis (Quiz Page) --><div id="quiz-page" class="page hidden w-full max-w-xl">
            <div class="glass-card fade-in">
                <div class="flex justify-between items-center mb-4">
                    <div id="quiz-level-info" class="text-sm font-medium text-blue-600 bg-blue-100 px-3 py-1 rounded-full">Level X: Tema</div>
                    <div id="quiz-score-display" class="text-lg font-bold text-yellow-600">Skor: 0</div>
                </div>
                <div id="question-area" class="min-h-[250px] flex flex-col justify-between">
                    <div>
                        <p id="question-text" class="text-xl font-semibold text-gray-800 mb-6 slide-up">Pertanyaan...</p>
                    </div>
                    <div id="options-container" class="space-y-3">
                        <!-- Options buttons will be generated here --></div>
                </div>
            </div>
        </div>

        <!-- Halaman Hasil (Result Page) --><div id="result-page" class="page hidden">
            <div class="glass-card text-center slide-up">
                <h2 id="result-title" class="text-3xl font-bold mb-4 text-blue-900">Hasil Kuis Level X</h2>
                <div class="flex flex-col items-center mb-6">
                    <p class="text-lg text-gray-700">Skor Akhir:</p>
                    <p id="final-score" class="text-6xl font-extrabold text-yellow-600 my-2">0</p>
                    <p id="result-message" class="text-xl font-medium"></p>
                </div>
                
                <button id="next-level-btn" class="hidden w-full py-3 px-6 rounded-xl btn-glow text-lg font-bold uppercase tracking-wider mb-3">
                    Lanjut ke Level Berikutnya
                </button>
                <button id="try-again-btn" class="hidden w-full py-3 px-6 rounded-xl bg-red-600 text-white hover:bg-red-700 transition text-lg font-bold uppercase tracking-wider mb-3">
                    Coba Lagi
                </button>
                <button id="back-to-menu-btn" class="w-full py-3 px-6 rounded-xl bg-gray-300 text-gray-800 hover:bg-gray-400 transition text-lg font-bold font-semibold">
                    Kembali ke Menu Level
                </button>
            </div>
        </div>

    </div>

    <script>
        // --- 1. DATA KUIS (10 Level x 5 Soal) ---
        const quizData = [
            // Level 1: Pengenalan Kediri
            { theme: "Pengenalan Kediri", questions: [
                { q: "Monumen ikonik Kediri yang sering disebut replika Arc de Triomphe adalah...", options: ["Tugu Pahlawan", "Simpang Lima Gumul", "Monumen Suryo", "Jembatan Brawijaya"], answer: "Simpang Lima Gumul" },
                { q: "Kediri terkenal dengan julukan kota...", options: ["Tahu", "Apel", "Gudeg", "Sate"], answer: "Tahu" },
                { q: "Makanan khas Kediri yang terbuat dari olahan kacang kedelai, memiliki tekstur padat, dan warna kuning, adalah...", options: ["Tahu Takwa", "Tahu Sumedang", "Tahu Pong", "Tahu Petis"], answer: "Tahu Takwa" },
                { q: "Sungai besar yang membelah Kota dan Kabupaten Kediri adalah...", options: ["Bengawan Solo", "Brantas", "Serayu", "Citarum"], answer: "Brantas" },
                { q: "Bandar udara yang baru diresmikan di Kediri adalah...", options: ["Dhoho International Airport", "Juanda Airport", "Abdul Rachman Saleh Airport", "Adi Sucipto Airport"], answer: "Dhoho International Airport" },
            ]},
            // Level 2: Geografi Kediri
            { theme: "Geografi Kediri", questions: [
                { q: "Gunung tertinggi yang berbatasan langsung dengan Kabupaten Kediri di sisi timur adalah...", options: ["Gunung Semeru", "Gunung Kelud", "Gunung Bromo", "Gunung Wilis"], answer: "Gunung Kelud" },
                { q: "Kediri berbatasan di sebelah barat dengan...", options: ["Nganjuk dan Jombang", "Tulungagung dan Blitar", "Ponorogo dan Trenggalek", "Madiun dan Ngawi"], answer: "Nganjuk dan Jombang" },
                { q: "Air Terjun Dolo dan Air Terjun Irenggolo berada di lereng...", options: ["Gunung Kelud", "Gunung Wilis", "Gunung Semeru", "Gunung Lawu"], answer: "Gunung Wilis" },
                { q: "Berapa jumlah kecamatan yang ada di Kota Kediri?", options: ["5 Kecamatan", "3 Kecamatan", "7 Kecamatan", "10 Kecamatan"], answer: "3 Kecamatan" },
                { q: "Danau buatan yang sering digunakan untuk irigasi dan wisata di Kediri adalah...", options: ["Waduk Selorejo", "Waduk Bening Widas", "Waduk Darungan", "Waduk Waru Turi"], answer: "Waduk Waru Turi" },
            ]},
            // Level 3: Kuliner Khas Kediri
            { theme: "Kuliner Khas Kediri", questions: [
                { q: "Selain Tahu Takwa, Kediri memiliki Tahu Pong yang disajikan dengan bumbu petis. Nama tahu ini merujuk pada...", options: ["Rasa Asin", "Bentuk Kotak", "Berongga di Dalam", "Warna Merah"], answer: "Berongga di Dalam" },
                { q: "Makanan nasi dengan aneka sayuran, lauk, dan sambal khas Kediri yang pedas disebut...", options: ["Nasi Goreng", "Pecel", "Gado-Gado", "Rawon"], answer: "Pecel" },
                { q: "Minuman tradisional Kediri yang terbuat dari beras ketan hitam yang difermentasi, sering disebut...", options: ["Dawet", "Es Cendol", "Tape Ketan Hitam", "Es Legen"], answer: "Tape Ketan Hitam" },
                { q: "Sambal khas Kediri yang terbuat dari terasi udang yang dimasak dengan tomat dan cabai adalah...", options: ["Sambal Terasi", "Sambal Tumpang", "Sambal Dabu-Dabu", "Sambal Matah"], answer: "Sambal Tumpang" },
                { q: "Lauk khas dari Kediri yang berupa kerupuk dari kulit sapi yang digoreng adalah...", options: ["Krecek", "Rambak", "Opak", "Lanting"], answer: "Rambak" },
            ]},
            // Level 4: Kesenian Kediri
            { theme: "Kesenian Kediri", questions: [
                { q: "Tari khas Kediri yang melibatkan penari dengan kuda tiruan dan penari berkepala singa adalah...", options: ["Reog Ponorogo", "Jaranan", "Tari Topeng", "Tari Remo"], answer: "Jaranan" },
                { q: "Alat musik tradisional yang sering mengiringi kesenian Jaranan dan terbuat dari bambu adalah...", options: ["Gamelan", "Angklung", "Gong", "Kompang"], answer: "Kompang" },
                { q: "Salah satu jenis batik Kediri yang terkenal dengan motif Simpang Lima Gumul adalah...", options: ["Batik Parang", "Batik Kawung", "Batik Khas Kediri", "Batik Truntum"], answer: "Batik Khas Kediri" },
                { q: "Wayang khas Kediri yang terkenal adalah Wayang Klithik, yang terbuat dari bahan...", options: ["Kulit", "Kertas", "Kayu", "Plastik"], answer: "Kayu" },
                { q: "Seniman legendaris dari Kediri yang terkenal dengan karya-karya lukisan naturalisnya adalah...", options: ["Affandi", "Raden Saleh", "Basuki Abdullah", "Trubus Soedarsono"], answer: "Trubus Soedarsono" },
            ]},
            // Level 5: Ciri Khas dan Keunikan Kediri
            { theme: "Ciri Khas dan Keunikan Kediri", questions: [
                { q: "Slogan yang melekat pada Kota Kediri adalah...", options: ["Bersinar", "Berbudaya", "Jayabaya", "Harmoni"], answer: "Harmoni" },
                { q: "Komoditas pertanian utama dari Kabupaten Kediri yang terkenal adalah...", options: ["Tebu", "Padi", "Cengkeh", "Nanas"], answer: "Nanas" },
                { q: "Perusahaan rokok besar yang berbasis di Kediri dan menjadi salah satu ikon kota adalah...", options: ["Gudang Garam", "Sampoerna", "Djarum", "Bentoel"], answer: "Gudang Garam" },
                { q: "Panggilan akrab untuk masyarakat Kediri yang biasanya digunakan untuk menyapa teman adalah...", options: ["Cak", "Mas", "Dulur", "Rek"], answer: "Dulur" },
                { q: "Desa yang terkenal dengan produksi tahu takwa secara massal di Kediri adalah...", options: ["Desa Tiron", "Desa Ngasem", "Desa Sambi", "Desa Kediri"], answer: "Desa Tiron" },
            ]},
            // Level 6: Tempat Wisata Kediri
            { theme: "Tempat Wisata Kediri", questions: [
                { q: "Goa bersejarah yang terletak di lereng Gunung Klotok, Kota Kediri adalah...", options: ["Goa Gong", "Goa Selomangleng", "Goa Tabuhan", "Goa Jatijajar"], answer: "Goa Selomangleng" },
                { q: "Tempat wisata religi yang merupakan makam dari tokoh pendiri Pondok Pesantren Lirboyo adalah...", options: ["Makam Sunan Ampel", "Makam Gus Dur", "Makam Kyai Abdul Karim", "Makam Wali Songo"], answer: "Makam Kyai Abdul Karim" },
                { q: "Museum di Kediri yang menyimpan koleksi benda-benda sejarah kerajaan adalah...", options: ["Museum Angkut", "Museum Satwa", "Museum Airlangga", "Museum Trowulan"], answer: "Museum Airlangga" },
                { q: "Destinasi wisata alam yang menawarkan pemandangan pegunungan dan sering digunakan untuk berkemah adalah...", options: ["Pantai Prigi", "Gunung Kelud", "Puncak Mahameru", "Pulau Sempu"], answer: "Gunung Kelud" },
                { q: "Taman kota yang menjadi paru-paru kota Kediri dan tempat rekreasi keluarga adalah...", options: ["Taman Bungkul", "Taman Sekartaji", "Taman Alun-Alun", "Taman Hutan Raya"], answer: "Taman Sekartaji" },
            ]},
            // Level 7: Sejarah Kerajaan Kediri
            { theme: "Sejarah Kerajaan Kediri", questions: [
                { q: "Kerajaan besar yang berpusat di Kediri dan mencapai puncak kejayaannya pada masa Raja Jayabaya adalah...", options: ["Singhasari", "Majapahit", "Daha/Kediri", "Sriwijaya"], answer: "Daha/Kediri" },
                { q: "Prasasti peninggalan Raja Airlangga yang membagi Kerajaan Mataram Kuno menjadi Janggala dan Panjalu (Kediri) adalah...", options: ["Prasasti Kanjuruhan", "Prasasti Calcuta (Pucangan)", "Prasasti Talang Tuwo", "Prasasti Canggal"], answer: "Prasasti Calcuta (Pucangan)" },
                { q: "Tokoh yang terkenal dengan ramalan masa depannya (Jangka Jayabaya) adalah...", options: ["Mpu Tantular", "Raja Kertanegara", "Raja Jayabaya", "Gajah Mada"], answer: "Raja Jayabaya" },
                { q: "Karya sastra terkenal pada masa Kerajaan Kediri yang ditulis oleh Mpu Sedah dan Mpu Panuluh adalah...", options: ["Kitab Nagarakertagama", "Kitab Pararaton", "Kitab Bharatayudha", "Kitab Sutasoma"], answer: "Kitab Bharatayudha" },
                { q: "Raja terakhir Kerajaan Kediri sebelum ditaklukkan oleh Ken Arok (Singhasari) adalah...", options: ["Kertajaya", "Dharmavamsa", "Airlangga", "Jayakatwang"], answer: "Kertajaya" },
            ]},
            // Level 8: Tokoh-Tokoh Kediri
            { theme: "Tokoh-Tokoh Kediri", questions: [
                { q: "Salah satu pahlawan nasional dari Kediri yang dikenal sebagai ulama besar dan pendiri Pondok Pesantren Lirboyo adalah...", options: ["KH Hasyim Asy'ari", "KH Abdul Karim", "KH Ahmad Dahlan", "KH Wahid Hasyim"], answer: "KH Abdul Karim" },
                { q: "Pendiri Kerajaan Kediri (Panjalu) setelah pembagian Kerajaan Mataram Kuno oleh Airlangga adalah...", options: ["Sri Samarawijaya", "Mpu Sindok", "Ken Arok", "Raja Balaputradewa"], answer: "Sri Samarawijaya" },
                { q: "Tokoh terkenal dari Kediri yang merupakan pencipta lambang negara Garuda Pancasila adalah...", options: ["Sultan Hamengkubuwono IX", "Mohammad Hatta", "Sultan Hamid II", "Soekarno"], answer: "Sultan Hamid II" },
                { q: "Pujangga Kerajaan Kediri yang terkenal dengan Kitab Arjunawiwaha adalah...", options: ["Mpu Panuluh", "Mpu Kanwa", "Mpu Dharmaja", "Mpu Tantular"], answer: "Mpu Kanwa" },
                { q: "Siapa nama Wali Kota Kediri yang pertama menjabat setelah kemerdekaan?", options: ["Soekarwo", "Moestopo", "RM Soeprapto", "Subroto"], answer: "RM Soeprapto" },
            ]},
            // Level 9: Peninggalan Sejarah Kediri
            { theme: "Peninggalan Sejarah Kediri", questions: [
                { q: "Candi peninggalan Kerajaan Kediri yang terletak di kaki Gunung Wilis adalah...", options: ["Candi Prambanan", "Candi Borobudur", "Candi Penataran", "Candi Surowono"], answer: "Candi Surowono" },
                { q: "Prasasti yang berisi tentang pemberian hadiah tanah kepada rakyat oleh Raja Sri Jayawarsa adalah...", options: ["Prasasti Ngantang", "Prasasti Sirah Keting", "Prasasti Anjuk Ladang", "Prasasti Wurare"], answer: "Prasasti Sirah Keting" },
                { q: "Situs bersejarah yang dipercaya sebagai petilasan pertapaan Raja Airlangga adalah...", options: ["Situs Trowulan", "Situs Goa Selomangleng", "Situs Tirta Yoni", "Situs Sendang Kamal"], answer: "Situs Tirta Yoni" },
                { q: "Benteng pertahanan Belanda yang masih berdiri kokoh di Kediri adalah...", options: ["Benteng Van Der Wijck", "Benteng Vredeburg", "Benteng Pendem", "Benteng Fort Rotterdam"], answer: "Benteng Pendem" },
                { q: "Candi yang dulunya merupakan makam pendiri Kerajaan Kediri, Sri Samarawijaya, adalah...", options: ["Candi Tegowangi", "Candi Sumberawan", "Candi Jago", "Candi Muara Takus"], answer: "Candi Tegowangi" },
            ]},
            // Level 10: Kuis Campuran Tingkat Lanjut
            { theme: "Kuis Campuran Tingkat Lanjut", questions: [
                { q: "Warna yang mendominasi lambang Kabupaten Kediri adalah...", options: ["Merah dan Putih", "Hijau dan Kuning", "Biru dan Emas", "Hitam dan Putih"], answer: "Biru dan Emas" },
                { q: "Festival kebudayaan Kediri yang menampilkan tarian dan musik tradisional secara besar-besaran adalah...", options: ["Jember Fashion Carnaval", "Grebeg Sudiro", "Pekan Budaya Kabupaten Kediri", "Festival Kesenian Rakyat"], answer: "Pekan Budaya Kabupaten Kediri" },
                { q: "Berapakah jumlah gapura (pintu masuk) yang ada pada Simpang Lima Gumul?", options: ["5 Gapura", "4 Gapura", "6 Gapura", "8 Gapura"], answer: "4 Gapura" },
                { q: "Nama lain dari Kerajaan Kediri pada masa-masa awal berdirinya adalah...", options: ["Janggala", "Singosari", "Daha", "Panjalu"], answer: "Panjalu" },
                { q: "Jenis tanaman yang paling banyak ditanam di lereng Gunung Wilis bagian Kediri adalah...", options: ["Kopi dan Cengkeh", "Teh dan Kina", "Karet dan Sawit", "Tembakau dan Kapas"], answer: "Kopi dan Cengkeh" },
            ]},
        ];

        // --- 2. VARIABEL GLOBAL DAN STATE ---
        let playerName = '';
        let currentLevel = 1;
        let currentQuestionIndex = 0;
        let currentScore = 0;
        let playerScores = JSON.parse(localStorage.getItem('kediriQuizScores')) || {};
        let isMuted = false;
        const PASSING_SCORE = 60;
        const MAX_LEVEL = quizData.length;
        const API_KEY = ""; // Kunci API untuk Google Gemini (dibiarkan kosong)

        // --- 3. INISIALISASI AUDIO (TONE.JS) ---
        let bgm, correctSynth, wrongSynth, buttonClick;

        const initAudio = () => {
            // Synth untuk BGM (Khas Kediri - menggunakan nada pentatonis yang lembut)
            // Menggunakan FMSynth untuk suara yang lebih 'berwarna'
            bgm = new Tone.FMSynth({
                modulationIndex: 10,
                envelope: { attack: 0.01, decay: 0.2, sustain: 0.1, release: 0.1 },
                harmonicity: 3,
                oscillator: { type: "square" }
            }).toDestination();
            // Loop sederhana, nada F4 - G4 - A4 (pentatonik minor F)
            const loop = new Tone.Loop(time => {
                if (!isMuted) {
                    bgm.triggerAttackRelease("F4", "8n", time);
                    bgm.triggerAttackRelease("G4", "8n", time + Tone.Time("8n").toSeconds());
                    bgm.triggerAttackRelease("A4", "8n", time + Tone.Time("4n").toSeconds());
                }
            }, "2n").start(0);
            Tone.Transport.start();

            // Synth untuk Jawaban Benar
            correctSynth = new Tone.Synth({
                oscillator: { type: "sine" },
                envelope: { attack: 0.001, decay: 0.2, sustain: 0.01, release: 0.5 }
            }).toDestination();

            // Synth untuk Jawaban Salah
            wrongSynth = new Tone.Synth({
                oscillator: { type: "sawtooth" },
                envelope: { attack: 0.001, decay: 0.2, sustain: 0.01, release: 0.5 }
            }).toDestination();

            // Synth untuk Klik Tombol
            buttonClick = new Tone.NoiseSynth({
                noise: { type: "white" },
                envelope: { attack: 0.001, decay: 0.05, sustain: 0, release: 0.05 }
            }).toDestination();
        };

        const playSound = (type) => {
            if (isMuted) return;
            // Pastikan Tone.js sudah aktif
            if (Tone.context.state !== 'running') {
                Tone.start();
            }

            if (type === 'correct') {
                correctSynth.triggerAttackRelease("C5", "8n");
            } else if (type === 'wrong') {
                wrongSynth.triggerAttackRelease("C3", "4n");
            } else if (type === 'button') {
                buttonClick.triggerAttackRelease("16n");
            }
        };

        // --- 4. FUNGSI UTILITY UI DAN NAVIGASI ---
        const showPage = (pageId) => {
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => {
                if (page.id === pageId) {
                    page.classList.remove('hidden');
                    page.classList.add('active');
                    // Tambahkan animasi fade-in/slide-up untuk elemen utama
                    page.querySelector('.slide-up, .fade-in')?.classList.add('slide-up');
                    setTimeout(() => {
                         page.querySelector('.slide-up, .fade-in')?.classList.remove('slide-up');
                    }, 600);
                } else {
                    page.classList.add('hidden');
                    page.classList.remove('active');
                }
            });
            // Update tampilan background
            document.querySelector('.slg-bg').style.filter = pageId === 'home-page' ? 'blur(8px)' : 'blur(0px)';
        };

        // --- 5. LOKAL STORAGE DAN PROGRESS ---
        const loadPlayerProgress = () => {
            const playerInfo = localStorage.getItem('kediriQuizPlayer');
            if (playerInfo) {
                const data = JSON.parse(playerInfo);
                playerName = data.name;
                document.getElementById('display-name').textContent = data.name;
                document.getElementById('display-class').textContent = data.class;
                document.getElementById('display-school').textContent = data.school;
                
                document.getElementById('welcome-box').classList.add('hidden');
                document.getElementById('player-info-display').classList.remove('hidden');
            } else {
                 document.getElementById('welcome-box').classList.remove('hidden');
                 document.getElementById('player-info-display').classList.add('hidden');
            }
            
            playerScores = JSON.parse(localStorage.getItem('kediriQuizScores')) || {};
        };

        const savePlayerInfo = (name, className, school) => {
            const playerInfo = { name, class: className, school };
            localStorage.setItem('kediriQuizPlayer', JSON.stringify(playerInfo));
            loadPlayerProgress();
        };

        const saveScore = (level, score) => {
            playerScores[level] = score;
            localStorage.setItem('kediriQuizScores', JSON.stringify(playerScores));
        };

        // --- 6. LOGIC HALAMAN UTAMA (HOME) ---
        document.getElementById('player-form').addEventListener('submit', function(e) {
            e.preventDefault();
            playSound('button');

            const name = document.getElementById('player-name').value.trim();
            const className = document.getElementById('player-class').value.trim();
            const school = document.getElementById('player-school').value.trim();

            if (name === '' || className === '' || school === '') {
                document.getElementById('error-message').classList.remove('hidden');
                return;
            }
            document.getElementById('error-message').classList.add('hidden');
            savePlayerInfo(name, className, school);
            
            generateLevelButtons();
            showPage('level-select-page');
        });

        document.getElementById('resume-quiz-btn').addEventListener('click', () => {
             playSound('button');
             generateLevelButtons();
             showPage('level-select-page');
        });

        document.getElementById('change-player-btn').addEventListener('click', () => {
             playSound('button');
             localStorage.removeItem('kediriQuizPlayer');
             localStorage.removeItem('kediriQuizScores');
             loadPlayerProgress();
        });


        // --- 7. LOGIC HALAMAN PEMILIHAN LEVEL ---
        const generateLevelButtons = () => {
            const grid = document.getElementById('level-grid');
            grid.innerHTML = '';
            
            for (let i = 1; i <= MAX_LEVEL; i++) {
                const level = i;
                const theme = quizData[i - 1].theme;
                const lastLevelScore = playerScores[level - 1] || 0;
                
                // Level 1 selalu aktif
                const isLocked = level > 1 && lastLevelScore < PASSING_SCORE;
                const scoreDisplay = playerScores[level] !== undefined ? `<span class="text-sm font-bold ml-2">(${playerScores[level]} Poin)</span>` : '';
                
                const button = document.createElement('button');
                button.className = `level-btn w-full p-4 text-left shadow-lg ${isLocked ? 'locked' : ''}`;
                button.innerHTML = `
                    <div class="text-xl">Level ${level}</div>
                    <div class="text-sm opacity-80 mt-1">${theme}</div>
                    ${scoreDisplay}
                `;
                button.disabled = isLocked;
                
                if (!isLocked) {
                    button.addEventListener('click', () => {
                        playSound('button');
                        currentLevel = level;
                        startQuiz(level);
                    });
                }
                
                grid.appendChild(button);
            }
        };

        // --- 8. LOGIC KUIS ---
        const startQuiz = (level) => {
            currentLevel = level;
            currentQuestionIndex = 0;
            currentScore = 0;

            document.getElementById('quiz-score-display').textContent = `Skor: ${currentScore}`;
            document.getElementById('quiz-level-info').textContent = `Level ${level}: ${quizData[level - 1].theme}`;
            
            showPage('quiz-page');
            displayQuestion();
        };
        
        const displayQuestion = () => {
            const levelData = quizData[currentLevel - 1];
            const qData = levelData.questions[currentQuestionIndex];

            if (!qData) {
                showResults();
                return;
            }

            const questionTextElement = document.getElementById('question-text');
            const optionsContainer = document.getElementById('options-container');

            // Reset dan animasikan pertanyaan baru
            questionTextElement.classList.remove('fade-in');
            void questionTextElement.offsetWidth; // Trigger reflow to restart animation
            questionTextElement.classList.add('fade-in');
            questionTextElement.textContent = `Soal ${currentQuestionIndex + 1} dari 5: ${qData.q}`;

            optionsContainer.innerHTML = '';
            
            // Loop untuk opsi
            qData.options.forEach((option, index) => {
                const optionChar = String.fromCharCode(65 + index); // A, B, C, D
                const optionButton = document.createElement('button');
                optionButton.className = `w-full text-left p-3 rounded-xl bg-white text-gray-800 shadow-md hover:bg-yellow-100 transition duration-200 ease-in-out font-medium border-l-4 border-blue-500`;
                optionButton.textContent = `${optionChar}. ${option}`;
                optionButton.onclick = () => handleAnswer(option, qData.answer);
                optionsContainer.appendChild(optionButton);
            });
        };

        const handleAnswer = (selectedOption, correctAnswer) => {
            // Nonaktifkan semua tombol setelah memilih
            const options = document.querySelectorAll('#options-container button');
            options.forEach(btn => btn.disabled = true);

            let isCorrect = selectedOption === correctAnswer;
            let feedbackColor = isCorrect ? 'bg-green-500 border-green-700' : 'bg-red-500 border-red-700';

            // Berikan feedback visual
            options.forEach(btn => {
                if (btn.textContent.includes(selectedOption)) {
                    btn.classList.add(feedbackColor, 'text-white', 'shadow-xl');
                } else if (btn.textContent.includes(correctAnswer)) {
                    // Highlight jawaban benar jika jawaban salah
                    if (!isCorrect) {
                        btn.classList.add('bg-green-200', 'border-green-500');
                    }
                }
            });

            // Update skor dan suara
            if (isCorrect) {
                currentScore += 20;
                playSound('correct');
            } else {
                currentScore -= 10;
                playSound('wrong');
            }
            
            document.getElementById('quiz-score-display').textContent = `Skor: ${currentScore}`;

            // Lanjut ke soal berikutnya setelah jeda
            setTimeout(() => {
                currentQuestionIndex++;
                displayQuestion();
            }, 1000);
        };

        // --- 9. LOGIC HALAMAN HASIL ---
        const showResults = () => {
            saveScore(currentLevel, currentScore); // Simpan skor
            
            const titleEl = document.getElementById('result-title');
            const scoreEl = document.getElementById('final-score');
            const messageEl = document.getElementById('result-message');
            const nextBtn = document.getElementById('next-level-btn');
            const tryAgainBtn = document.getElementById('try-again-btn');
            
            titleEl.textContent = `Hasil Kuis Level ${currentLevel}`;
            scoreEl.textContent = currentScore;
            
            nextBtn.classList.add('hidden');
            tryAgainBtn.classList.add('hidden');
            messageEl.classList.remove('text-green-600', 'text-red-600');

            if (currentScore >= PASSING_SCORE) {
                messageEl.textContent = "Selamat! Anda Lolos dan Level Berikutnya Terbuka!";
                messageEl.classList.add('text-green-600');
                
                // Cek apakah ada level berikutnya
                if (currentLevel < MAX_LEVEL) {
                    nextBtn.classList.remove('hidden');
                    nextBtn.textContent = `Lanjut ke Level ${currentLevel + 1}`;
                } else {
                    messageEl.textContent = "Luar Biasa! Anda telah menyelesaikan SEMUA level Kuis Kediri Raya!";
                }

            } else {
                messageEl.textContent = "Maaf, Anda belum mencapai batas skor minimal. Coba lagi!";
                messageEl.classList.add('text-red-600');
                tryAgainBtn.classList.remove('hidden');
            }

            showPage('result-page');
        };

        // --- 10. EVENT LISTENERS HASIL ---
        document.getElementById('next-level-btn').addEventListener('click', () => {
            playSound('button');
            currentLevel++; // Otomatis pindah ke level berikutnya
            startQuiz(currentLevel);
        });

        document.getElementById('try-again-btn').addEventListener('click', () => {
            playSound('button');
            startQuiz(currentLevel); // Coba level yang sama
        });

        document.getElementById('back-to-menu-btn').addEventListener('click', () => {
            playSound('button');
            generateLevelButtons();
            showPage('level-select-page');
        });

        // --- 11. INISIALISASI DAN MUTE/UNMUTE ---
        document.getElementById('mute-btn').addEventListener('click', () => {
            isMuted = !isMuted;
            const icon = document.getElementById('mute-btn').querySelector('svg path');
            if (isMuted) {
                // Ganti ikon menjadi muted (x mark)
                 icon.setAttribute('d', 'M6 18L18 6M6 6l12 12');
            } else {
                // Ganti ikon menjadi speaker
                icon.setAttribute('d', 'M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H3a1 1 0 01-1-1V9a1 1 0 011-1h2.586l7-7h1a1 1 0 011 1v12a1 1 0 01-1 1h-1l-7-7z');
            }
        });

        // Inisialisasi aplikasi saat DOM siap
        window.onload = function() {
            // Inisialisasi Tone.js (memerlukan interaksi pengguna pertama)
            const body = document.querySelector('body');
            body.addEventListener('click', () => {
                if (Tone.context.state !== 'running') {
                    Tone.start();
                    initAudio(); // Inisialisasi audio setelah interaksi pertama
                }
            }, { once: true });

            loadPlayerProgress();
            showPage('home-page');
        };
    </script>
</body>
</html>
